<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <a-box position="0 0 -5" width="5" height="3" depth="5" color="#cccccc"></a-box>

    <a-box id="switch" position="0 1 -3" width="0.5" height="0.2" depth="0.2" 
           color="#ff0000" interactive></a-box>

    <a-text id="status-text" value="Loading..." position="-0.5 1.5 -3" 
           color="#000000" align="center"></a-text>

    <a-sphere id="pointer" position="0 1.2 -2.8" radius="0.05" color="#000000"></a-sphere>
  </a-scene>

  <script>
    const switchEl = document.getElementById("switch");
    const statusText = document.getElementById("status-text");
    const apiUrl = "https://roomcontrol.glitch.me/app-status";
    const toggleUrl = "https://roomcontrol.glitch.me/toggle-app?state=";

    async function fetchStatus() {
      try {
        const response = await fetch(apiUrl, { method: 'GET' }); 
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        updateSwitch(data.status); 
      } catch (error) {
        console.error("Error fetching status:", error);
        statusText.setAttribute("value", "Error: Failed to fetch status"); 
      }
    }

    function updateSwitch(status) {
      if (status === "on") {
        switchEl.setAttribute("color", "#00ff00");
        statusText.setAttribute("value", "Status: ON");
      } else {
        switchEl.setAttribute("color", "#ff0000");
        statusText.setAttribute("value", "Status: OFF");
      }
    }

    async function toggleSwitch() {
      const currentStatus = statusText.getAttribute("value").includes("ON") ? "off" : "on";
      try {
        const response = await fetch(toggleUrl + currentStatus, { method: 'GET' });
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        updateSwitch(currentStatus);
      } catch (error) {
        console.error("Error toggling status:", error);
        statusText.setAttribute("value", "Error: Failed to toggle state"); 
      }
    }

    switchEl.addEventListener("click", () => {
      toggleSwitch();
    });

    fetchStatus();
  </script>
</body>
</html>